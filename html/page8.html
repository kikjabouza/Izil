<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Journal - Autism Friendly</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #4a6fa5;
            --primary-foreground: #ffffff;
            --primary-hover: #3a5a8c;
            --secondary: #6c757d;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --background: #f8f9fa;
            --foreground: #1a1a1a;
            --card: #ffffff;
            --border: #e0e0e0;
            --muted: #f1f5f9;
            --muted-foreground: #64748b;
            --sunshine-light: rgba(255, 209, 102, 0.2);
            --calm-blue-light: rgba(59, 130, 246, 0.2);
            --lavender-light: rgba(157, 141, 241, 0.2);
            --peach-light: rgba(255, 184, 161, 0.2);
            --mint-light: rgba(136, 217, 230, 0.2);
            --shadow-soft: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-medium: 0 8px 24px rgba(0, 0, 0, 0.12);
            --shadow-glow: 0 8px 32px rgba(74, 111, 165, 0.2);
            --border-radius: 1rem;
            --border-radius-lg: 1.5rem;
            --border-radius-xl: 2rem;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: var(--foreground);
            min-height: 100vh;
            padding: 1rem;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Conteneur de l'image d'en-t√™te */
        .header-image-container {
            display: flex;
            justify-content: center;
            margin-bottom: 1.5rem;
            padding-top: 0.5rem;
        }

        /* Image d'en-t√™te - NOUVELLE IMAGE */
        .header-image {
            width: 280px;
            height: 150px;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-medium);
            object-fit: cover;
            border: 3px solid white;
            transition: transform 0.3s ease;
        }

        .header-image:hover {
            transform: scale(1.02);
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 2rem;
            animation: fadeIn 0.8s ease-out;
        }

        .header-emoji {
            font-size: 3rem;
            margin-bottom: 1rem;
            display: block;
            animation: float 3s ease-in-out infinite;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--foreground);
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1.1rem;
            color: var(--secondary);
        }

        /* Bouton d'acc√®s aux histoires */
        .stories-access {
            text-align: center;
            margin-bottom: 2rem;
        }

        .stories-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 2rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-hover) 100%);
            color: white;
            border: none;
            border-radius: var(--border-radius-xl);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-medium);
        }

        .stories-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-glow);
        }

        .stories-btn .emoji {
            font-size: 1.5rem;
        }

        /* Grille principale */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        @media (min-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* Carte */
        .card {
            background-color: var(--card);
            border-radius: var(--border-radius-xl);
            padding: 1.5rem;
            box-shadow: var(--shadow-soft);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: var(--shadow-glow);
            border-color: rgba(74, 111, 165, 0.2);
        }

        .card-elevated {
            box-shadow: var(--shadow-medium);
        }

        .card-calm {
            box-shadow: var(--shadow-soft);
            border-color: rgba(74, 111, 165, 0.2);
        }

        /* Titre de carte */
        .card h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--foreground);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* S√©lecteur d'humeur */
        .moods-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        @media (max-width: 640px) {
            .moods-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .mood-btn {
            padding: 1rem;
            border-radius: var(--border-radius-lg);
            border: 2px solid transparent;
            background-color: var(--muted);
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }

        .mood-btn:hover {
            transform: scale(1.1);
            background-color: rgba(74, 111, 165, 0.1);
        }

        .mood-btn.selected {
            background-color: var(--sunshine-light);
            border-color: var(--primary);
            box-shadow: var(--shadow-glow);
            transform: scale(1.05);
        }

        .mood-emoji {
            font-size: 2.5rem;
        }

        .mood-label {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--foreground);
        }

        /* Zone de texte */
        .note-container {
            margin-bottom: 1.5rem;
            position: relative;
        }

        .note-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--foreground);
            margin-bottom: 0.5rem;
        }

        .note-textarea {
            width: 100%;
            height: 6rem;
            padding: 1rem;
            border-radius: var(--border-radius-lg);
            border: 2px solid var(--border);
            background-color: var(--background);
            font-size: 1rem;
            resize: none;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }

        .note-textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Boutons de contr√¥le audio */
        .audio-controls {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .audio-btn {
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            border: none;
            background-color: var(--info);
            color: white;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .audio-btn:hover {
            background-color: #2563eb;
            transform: scale(1.05);
        }

        .audio-btn:disabled {
            background-color: var(--secondary);
            cursor: not-allowed;
            transform: none;
        }

        /* Bouton microphone */
        .mic-btn-container {
            position: relative;
        }

        .mic-btn {
            position: absolute;
            bottom: 0.75rem;
            right: 0.75rem;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            border: none;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mic-btn:hover {
            background-color: var(--primary-hover);
            transform: scale(1.1);
        }

        .mic-btn.recording {
            background-color: var(--danger);
            animation: pulse 1.5s infinite;
        }

        /* Bouton principal */
        .save-btn {
            width: 100%;
            padding: 1rem;
            border-radius: var(--border-radius-lg);
            border: none;
            background-color: var(--primary);
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .save-btn:hover {
            background-color: var(--primary-hover);
            transform: scale(1.02);
            box-shadow: var(--shadow-glow);
        }

        /* Historique des humeurs */
        .history-container {
            max-height: 24rem;
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .history-empty {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--secondary);
        }

        .history-emoji {
            font-size: 3rem;
            margin-bottom: 1rem;
            display: block;
        }

        /* √âl√©ment d'humeur */
        .mood-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-radius: var(--border-radius-lg);
            background-color: var(--muted);
            margin-bottom: 0.75rem;
            animation: slideIn 0.3s ease;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mood-item:hover {
            background-color: rgba(74, 111, 165, 0.1);
            transform: translateX(5px);
        }

        .mood-item-emoji {
            font-size: 2rem;
        }

        .mood-item-content {
            flex: 1;
        }

        .mood-item-date {
            font-size: 0.75rem;
            color: var(--secondary);
        }

        .mood-item-note {
            font-size: 0.875rem;
            color: var(--foreground);
            margin-top: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .note-type-badge {
            font-size: 0.7rem;
            padding: 0.1rem 0.3rem;
            border-radius: 0.25rem;
            background-color: var(--info);
            color: white;
        }

        .note-type-badge.text {
            background-color: var(--success);
        }

        .note-type-badge.voice {
            background-color: var(--warning);
        }

        /* Page de lecture */
        .reading-page {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--background);
            z-index: 2000;
            overflow-y: auto;
            padding: 1rem;
        }

        .reading-page.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .reading-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border);
        }

        .back-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: var(--border-radius-lg);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background-color: var(--primary-hover);
            transform: scale(1.05);
        }

        .reading-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--foreground);
            text-align: center;
            flex: 1;
        }

        .categories-nav {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .category-tab {
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius-lg);
            border: 2px solid var(--border);
            background-color: var(--card);
            color: var(--foreground);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .category-tab.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .category-tab:hover:not(.active) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-soft);
        }

        /* Contenu de l'histoire */
        .story-display {
            max-width: 800px;
            margin: 0 auto 2rem;
            background-color: var(--card);
            border-radius: var(--border-radius-xl);
            padding: 2rem;
            box-shadow: var(--shadow-medium);
        }

        .story-image-display {
            width: 100%;
            height: 150px; /* R√©duit pour un meilleur visuel */
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            margin-bottom: 2rem;
            position: relative;
        }

        .story-image-display img {
            width: 100%;
            height: 150%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .story-image-display:hover img {
            transform: scale(1.05);
        }

        .story-category-badge {
            position: absolute;
            top: 1rem;
            left: 1rem;
            padding: 0.5rem 1rem;
            background-color: var(--primary);
            color: white;
            border-radius: var(--border-radius);
            font-size: 0.875rem;
            font-weight: 600;
            z-index: 1;
        }

        .story-text {
            font-size: 1.1rem;
            line-height: 1.8;
            color: var(--foreground);
            margin-bottom: 2rem;
            white-space: pre-wrap;
            padding: 0 0.5rem;
        }

        /* Contr√¥les de lecture */
        .story-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .story-control-btn {
            padding: 1rem 2rem;
            border-radius: var(--border-radius-lg);
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .story-control-btn.primary {
            background-color: var(--primary);
            color: white;
        }

        .story-control-btn.primary:hover:not(:disabled) {
            background-color: var(--primary-hover);
            transform: scale(1.05);
        }

        .story-control-btn.secondary {
            background-color: var(--secondary);
            color: white;
        }

        .story-control-btn.secondary:hover:not(:disabled) {
            background-color: #5a6268;
            transform: scale(1.05);
        }

        .story-control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* √âvaluation d'humeur */
        .story-mood-evaluation {
            background-color: var(--muted);
            border-radius: var(--border-radius-xl);
            padding: 2rem;
            margin-top: 2rem;
        }

        .mood-evaluation-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--foreground);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .story-moods-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        @media (max-width: 768px) {
            .story-moods-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 480px) {
            .story-moods-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .story-mood-btn {
            padding: 1rem;
            border-radius: var(--border-radius-lg);
            border: 2px solid transparent;
            background-color: var(--card);
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .story-mood-btn:hover {
            transform: scale(1.1);
            background-color: rgba(74, 111, 165, 0.1);
        }

        .story-mood-btn.selected {
            background-color: var(--sunshine-light);
            border-color: var(--primary);
            box-shadow: var(--shadow-glow);
            transform: scale(1.05);
        }

        .story-mood-emoji {
            font-size: 2rem;
        }

        .story-mood-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--foreground);
        }

        /* Navigation entre histoires */
        .stories-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 2px solid var(--border);
        }

        .nav-btn {
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius-lg);
            border: 2px solid var(--primary);
            background-color: transparent;
            color: var(--primary);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-btn:hover:not(:disabled) {
            background-color: var(--primary);
            color: white;
            transform: scale(1.05);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            border-color: var(--secondary);
            color: var(--secondary);
        }

        .story-counter {
            font-size: 1rem;
            color: var(--secondary);
            font-weight: 500;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background-color: var(--success);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-medium);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1001;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast-error {
            background-color: var(--danger);
        }

        .toast-info {
            background-color: var(--info);
        }

        .toast-emoji {
            font-size: 1.25rem;
        }

        /* Modal pour voir les notes */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background-color: var(--card);
            border-radius: var(--border-radius-xl);
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            box-shadow: var(--shadow-medium);
            animation: slideUp 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--foreground);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--secondary);
            transition: color 0.3s ease;
        }

        .close-btn:hover {
            color: var(--danger);
        }

        .modal-note {
            font-size: 1rem;
            line-height: 1.6;
            color: var(--foreground);
            margin-bottom: 1.5rem;
            padding: 1rem;
            background-color: var(--muted);
            border-radius: var(--border-radius-lg);
            min-height: 100px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .modal-note.empty {
            color: var(--secondary);
            font-style: italic;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            border: none;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .modal-btn.primary {
            background-color: var(--primary);
            color: white;
        }

        .modal-btn.primary:hover {
            background-color: var(--primary-hover);
        }

        .modal-btn.secondary {
            background-color: var(--secondary);
            color: white;
        }

        .modal-btn.secondary:hover {
            background-color: #5a6268;
        }

        /* Animations CSS */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Scrollbar personnalis√©e */
        .history-container::-webkit-scrollbar {
            width: 6px;
        }

        .history-container::-webkit-scrollbar-track {
            background: var(--muted);
            border-radius: 3px;
        }

        .history-container::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }

        .history-container::-webkit-scrollbar-thumb:hover {
            background: var(--primary-hover);
        }
        /* Modal pour les images en grand */
.modal-image-container {
    width: 100%;
    max-height: 70vh;
    overflow: hidden;
    border-radius: var(--border-radius-lg);
    margin-bottom: 1.5rem;
    position: relative;
}

.modal-image-container img {
    width: 100%;
    height: 100%;
    object-fit: contain; /* Affiche toute l'image sans couper */
    border-radius: var(--border-radius-lg);
    background-color: var(--muted);
}

.modal-image-caption {
    text-align: center;
    font-size: 0.9rem;
    color: var(--secondary);
    margin-top: 0.5rem;
    font-style: italic;
}

/* Style pour les images cliquables dans les histoires */
.story-image-display {
    cursor: zoom-in; /* Curseur qui indique qu'on peut zoomer */
}

.story-image-display:hover {
    opacity: 0.95;
}
    </style>
</head>
<body>
    <!-- Page principale du journal -->
    <div class="container" id="main-page">
        <!-- Image d'en-t√™te centr√©e en haut - NOUVELLE IMAGE DE LIVRE -->
        <div class="header-image-container">
            <img src="https://cdn.pixabay.com/photo/2024/02/28/12/56/girl-8602014_1280.png" alt="Journal Autism Friendly" class="header-image">
        </div>

        <!-- En-t√™te -->
        <div class="header">
            <span class="header-emoji">üìî</span>
            <h1>Mon Journal - Autism Friendly</h1>
            <p>Comment te sens-tu aujourd'hui ?</p>
        </div>

        <!-- Bouton d'acc√®s aux histoires -->
        <div class="stories-access">
            <button class="stories-btn" id="stories-btn">
                <span class="emoji">üìö</span>
                Lire des histoires
            </button>
        </div>

        <!-- Grille principale -->
        <div class="main-grid">
            <!-- S√©lecteur d'humeur -->
            <div class="card card-elevated">
                <h2>
                    <span>üìÖ</span>
                    Mon humeur
                </h2>

                <div class="moods-grid" id="moods-grid">
                    <!-- Les boutons d'humeur seront g√©n√©r√©s par JavaScript -->
                </div>

                <!-- Zone de note -->
                <div class="note-container">
                    <label class="note-label">
                        Quelque chose √† dire ? (facultatif)
                    </label>
                    <div class="mic-btn-container">
                        <textarea 
                            class="note-textarea" 
                            id="note-textarea"
                            placeholder="√âcris ici ou enregistre un message vocal..."
                        ></textarea>
                        <button class="mic-btn" id="mic-btn">
                            <span id="mic-icon">üé§</span>
                        </button>
                    </div>
                    
                    <!-- Contr√¥les audio -->
                    <div class="audio-controls">
                        <button class="audio-btn" id="read-btn">
                            <span>üîä</span>
                            Lire le texte
                        </button>
                    </div>
                </div>

                <!-- Bouton d'enregistrement -->
                <button class="save-btn" id="save-btn">
                    <span>üíæ</span>
                    Enregistrer
                </button>
            </div>

            <!-- Historique des humeurs -->
            <div class="card card-calm">
                <h2>
                    <span>üìã</span>
                    Mes derni√®res humeurs
                </h2>

                <div class="history-container" id="history-container">
                    <!-- Les humeurs seront g√©n√©r√©es par JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Page de lecture des histoires -->
    <div class="reading-page" id="reading-page">
        <div class="container">
            <!-- En-t√™te de la page de lecture -->
            <div class="reading-header">
                <button class="back-btn" id="back-to-journal">
                    <span>‚Üê</span>
                    Retour au journal
                </button>
                <h2 class="reading-title">üìö Histoires Autism Friendly</h2>
                <div style="width: 140px;"></div> <!-- Pour l'√©quilibrage -->
            </div>

            <!-- Navigation par cat√©gorie -->
            <div class="categories-nav">
                <button class="category-tab active" data-category="all">
                    Toutes les histoires
                </button>
                <button class="category-tab" data-category="routine">
                    Histoires de routine
                </button>
                <button class="category-tab" data-category="funny">
                    Histoires dr√¥les
                </button>
            </div>

            <!-- Affichage de l'histoire -->
            <div class="story-display" id="story-display">
                <!-- L'histoire sera affich√©e ici -->
            </div>

            <!-- Navigation entre histoires -->
            <div class="stories-navigation">
                <button class="nav-btn" id="prev-story" disabled>
                    <span>‚Üê</span>
                    Histoire pr√©c√©dente
                </button>
                
                <div class="story-counter" id="story-counter">
                    Histoire 1 sur 10
                </div>
                
                <button class="nav-btn" id="next-story">
                    Histoire suivante
                    <span>‚Üí</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal pour voir les notes -->
    <div class="modal" id="note-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <span id="modal-emoji">üòä</span>
                    Note du journal
                    <span class="note-type-badge" id="modal-note-type"></span>
                </h2>
                <button class="close-btn" id="close-modal">&times;</button>
            </div>
            <div class="modal-note" id="modal-note-text">
                <!-- Le contenu de la note sera ins√©r√© ici -->
            </div>
            <div class="modal-actions">
                <button class="modal-btn secondary" id="close-note-btn">
                    <span>‚Üê</span>
                    Retour
                </button>
                <button class="modal-btn primary" id="read-note-btn">
                    <span>üîä</span>
                    Lire la note
                </button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <span class="toast-emoji" id="toast-emoji">üìù</span>
        <span id="toast-message">Ton humeur a √©t√© enregistr√©e !</span>
    </div>
    <!-- Modal pour voir les photos en grand -->
<div class="modal" id="image-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">
                <span id="image-modal-title">üì∏</span>
                Voir l'image
            </h2>
            <button class="close-btn" id="close-image-modal">&times;</button>
        </div>
        <div class="modal-image-container" id="modal-image-container">
            <!-- L'image en grand sera ins√©r√©e ici -->
        </div>
        <div class="modal-actions">
            <button class="modal-btn secondary" id="close-image-btn">
                <span>‚Üê</span>
                Retour
            </button>
        </div>
    </div>
</div>
    <script>
        // Donn√©es des histoires avec images redistribu√©es selon le contenu
        const stories = [
            {
                id: 1,
                category: "routine",
                title: "Le r√©veil de Tom",
                image: "https://cdn.pixabay.com/photo/2025/04/03/12/51/ai-generated-9511332_1280.png",
                content: "Tom se r√©veille chaque matin.\nIl ouvre ses yeux, b√¢ille et s'√©tire.\nIl met ses chaussons, va dans la salle de bain, se lave les dents et s'habille.\n¬´ Tout est pr√™t pour ma journ√©e ! ¬ª dit Tom.\nChaque matin, il suit la m√™me routine. Cela le rend heureux et calme."
            },
            {
                id: 2,
                category: "routine",
                title: "Le petit-d√©jeuner de Lila",
                image: "https://cdn.pixabay.com/photo/2023/08/12/02/58/sandwich-8184642_1280.png",
                content: "Lila aime son petit-d√©jeuner.\nChaque matin, elle met son bol, sa cuill√®re et verse le lait.\nElle mange tranquillement et met sa serviette sale dans le panier.\nApr√®s, elle range son bol.\n¬´ Routine termin√©e ! ¬ª dit Lila, fi√®re de elle."
            },
            {
                id: 3,
                category: "routine",
                title: "Les mains propres de Sami",
                image: "https://cdn.pixabay.com/photo/2020/03/26/22/57/hand-sanitizer-4972049_1280.png",
                content: "Sami joue dehors et se salit les mains.\nIl va au lavabo : savon, frotte, frotte, frotte‚Ä¶ rince et s√®che.\nChaque fois, il suit les m√™mes √©tapes.\n¬´ Mes mains sont propres ! ¬ª dit Sami.\nSa routine le rend fort et pr√™t √† jouer."
            },
            {
                id: 4,
                category: "routine",
                title: "La sieste de Nina",
                image: "https://cdn.pixabay.com/photo/2012/04/05/01/08/sleep-25528_1280.png",
                content: "Nina a une routine pour la sieste.\nElle met son doudou sur son lit, ferme ses yeux et respire doucement.\nElle s'allonge, √©coute la musique douce et ferme les yeux.\n¬´ Bonne sieste, Nina ! ¬ª dit sa maman.\nNina adore sa routine, elle sait ce qui va se passer."
            },
            {
                id: 5,
                category: "routine",
                title: "Le coucher de Max",
                image: "https://cdn.pixabay.com/photo/2021/09/28/14/20/bed-6664621_1280.png", // NOUVELLE IMAGE DE LIT
                content: "Max pr√©pare son lit tous les soirs.\nIl met son pyjama, se brosse les dents et dit bonne nuit √† son doudou.\nPuis il ferme les lumi√®res et s'installe sous la couverture.\n¬´ Bonne nuit, Max ! ¬ª dit papa.\nChaque soir, sa routine le rend calme et heureux."
            },
            {
                id: 6,
                category: "funny",
                title: "Le chat farceur",
                image: "https://cdn.pixabay.com/photo/2025/05/08/14/28/ai-generated-9587543_1280.png",
                content: "Le chat Mimi adore sauter dans les bo√Ætes.\nUn jour, il saute dans la bo√Æte du g√¢teau !\nMimi ressort avec des miettes sur la t√™te.\n¬´ Miaou ! ¬ª dit Mimi, tr√®s surpris.\nTout le monde rigole !"
            },
            {
                id: 7,
                category: "funny",
                title: "Le pantalon dans la t√™te",
                image: "https://cdn.pixabay.com/photo/2012/04/24/23/28/pants-41115_1280.png",
                content: "Tom met son pantalon‚Ä¶ mais il se trompe !\nLe pantalon va sur sa t√™te au lieu de ses jambes !\nTom rigole et dit : ¬´ Oups, ce n'est pas le bon trou ! ¬ª\nSa maman rit aussi."
            },
            {
                id: 8,
                category: "funny",
                title: "La chaussette fugitive",
                image: "https://cdn.pixabay.com/photo/2017/01/31/23/04/clothes-2027993_1280.png",
                content: "Lila cherche ses chaussettes.\nUne chaussette court toute seule !\nElle se cache sous la chaise et fait ¬´ hop ! hop ! ¬ª\nLila rigole et attrape enfin sa chaussette."
            },
            {
                id: 9,
                category: "funny",
                title: "Le bain surprise",
                image: "https://cdn.pixabay.com/photo/2020/06/02/13/19/bathroom-5250914_1280.png", // Image r√©utilis√©e pour bain
                content: "Sami met de l'eau dans la baignoire.\nQuand il met son canard, plouf ! le canard saute dans l'eau et fait un grand splash !\nSami rigole, tout mouill√©, mais tr√®s content."
            },
            {
                id: 10,
                category: "funny",
                title: "Le ballon rebondissant",
                image: "https://cdn.pixabay.com/photo/2012/04/05/01/41/balloon-25739_1280.png",
                content: "Max joue avec un ballon.\nLe ballon rebondit sur le mur‚Ä¶ puis sur sa t√™te !\nMax rigole et dit : ¬´ Ce ballon est rigolo ! ¬ª\nIl continue de jouer, en rigolant √† chaque rebond."
            }
        ];

        // Donn√©es des humeurs pour le journal
        const moods = [
            { emoji: 'üòä', label: 'Content', color: 'var(--sunshine-light)' },
            { emoji: 'üòê', label: 'Normal', color: 'var(--muted)' },
            { emoji: 'üò¢', label: 'Triste', color: 'var(--calm-blue-light)' },
            { emoji: 'üò†', label: '√ânerv√©', color: 'rgba(239, 68, 68, 0.2)' },
            { emoji: 'üò¥', label: 'Fatigu√©', color: 'var(--lavender-light)' },
            { emoji: 'ü§ó', label: 'C√¢lin', color: 'var(--peach-light)' },
            { emoji: 'üò∞', label: 'Inquiet', color: 'var(--muted)' },
            { emoji: 'ü•≥', label: 'Excit√©', color: 'var(--mint-light)' },
        ];

        // Options d'humeur pour les histoires
        const storyMoodOptions = [
            { emoji: 'üòä', label: 'Content', color: 'var(--sunshine-light)' },
            { emoji: 'üòÇ', label: 'Dr√¥le', color: 'var(--mint-light)' },
            { emoji: 'üòê', label: 'Normal', color: 'var(--muted)' },
            { emoji: 'üò¢', label: 'Triste', color: 'var(--calm-blue-light)' },
            { emoji: 'ü§î', label: 'Pensif', color: 'var(--lavender-light)' },
        ];

        // √âtat de l'application
        let selectedMood = null;
        let isRecording = false;
        let moodHistory = [];
        let speechSynthesis = window.speechSynthesis;
        let isSpeaking = false;
        let currentNoteType = 'text';
        
        // √âtat de la page de lecture
        let currentReadingCategory = 'all';
        let currentStoryIndex = 0;
        let filteredStories = [...stories];
        let storyMoodHistory = [];
        let currentUtterance = null;

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            loadMoodHistory();
            loadStoryMoodHistory();
            setupMoodButtons();
            setupEventListeners();
            setupReadingPage();
        });

        // Charger l'historique du journal
        function loadMoodHistory() {
            const savedMoods = localStorage.getItem('moodHistory');
            if (savedMoods) {
                moodHistory = JSON.parse(savedMoods);
            }
            renderMoodHistory();
        }

        // Charger l'historique des humeurs pour les histoires
        function loadStoryMoodHistory() {
            const savedMoods = localStorage.getItem('storyMoodHistory');
            if (savedMoods) {
                storyMoodHistory = JSON.parse(savedMoods);
            }
        }

        // Sauvegarder l'historique du journal
        function saveMoodHistory() {
            localStorage.setItem('moodHistory', JSON.stringify(moodHistory));
        }

        // Sauvegarder l'historique des histoires
        function saveStoryMoodHistory() {
            localStorage.setItem('storyMoodHistory', JSON.stringify(storyMoodHistory));
        }

        // Configurer les boutons d'humeur du journal
        function setupMoodButtons() {
            const moodsGrid = document.getElementById('moods-grid');
            moodsGrid.innerHTML = '';

            moods.forEach(mood => {
                const button = document.createElement('button');
                button.className = 'mood-btn';
                if (selectedMood === mood.emoji) {
                    button.classList.add('selected');
                    button.style.backgroundColor = mood.color;
                }

                button.innerHTML = `
                    <span class="mood-emoji">${mood.emoji}</span>
                    <span class="mood-label">${mood.label}</span>
                `;

                button.addEventListener('click', () => {
                    selectedMood = mood.emoji;
                    setupMoodButtons();
                });

                moodsGrid.appendChild(button);
            });
        }

        // Configurer les √©couteurs d'√©v√©nements
        function setupEventListeners() {
            // Bouton d'enregistrement
            document.getElementById('save-btn').addEventListener('click', saveMood);

            // Bouton microphone
            document.getElementById('mic-btn').addEventListener('click', toggleRecording);

            // Bouton de lecture
            document.getElementById('read-btn').addEventListener('click', readText);
            
            // Bouton de fermeture modal
            document.getElementById('close-modal').addEventListener('click', closeModal);
            document.getElementById('close-note-btn').addEventListener('click', closeModal);
            
            // Bouton de lecture dans le modal
            document.getElementById('read-note-btn').addEventListener('click', readModalNote);
            
            // Fermer le modal en cliquant √† l'ext√©rieur
            document.getElementById('note-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });

            // Entr√©e dans la zone de texte
            document.getElementById('note-textarea').addEventListener('input', function() {
                if (isRecording) {
                    toggleRecording();
                }
                
                // Activer/d√©sactiver le bouton de lecture
                const hasText = this.value.trim().length > 0;
                document.getElementById('read-btn').disabled = !hasText;
                
                // Mettre √† jour le type de note
                currentNoteType = 'text';
            });
            
            // Initialiser l'√©tat du bouton de lecture
            document.getElementById('read-btn').disabled = true;

            // Bouton d'acc√®s aux histoires
            document.getElementById('stories-btn').addEventListener('click', openReadingPage);
        }

        // Configurer la page de lecture
        function setupReadingPage() {
            // Bouton de retour
            document.getElementById('back-to-journal').addEventListener('click', closeReadingPage);
            
            // Boutons de cat√©gorie
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const category = this.dataset.category;
                    
                    // Mettre √† jour la cat√©gorie active
                    document.querySelectorAll('.category-tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Mettre √† jour et afficher les histoires
                    currentReadingCategory = category;
                    filterStories();
                    displayCurrentStory();
                });
            });
            
            // Boutons de navigation
            document.getElementById('prev-story').addEventListener('click', showPreviousStory);
            document.getElementById('next-story').addEventListener('click', showNextStory);
        }

        // Ouvrir la page de lecture
        function openReadingPage() {
            document.getElementById('main-page').style.display = 'none';
            document.getElementById('reading-page').classList.add('active');
            
            // R√©initialiser l'affichage
            filterStories();
            displayCurrentStory();
        }

        // Fermer la page de lecture
        function closeReadingPage() {
            document.getElementById('reading-page').classList.remove('active');
            document.getElementById('main-page').style.display = 'block';
            
            // Arr√™ter la lecture audio si en cours
            if (isSpeaking) {
                speechSynthesis.cancel();
                isSpeaking = false;
            }
        }

        // Filtrer les histoires par cat√©gorie
        function filterStories() {
            if (currentReadingCategory === 'all') {
                filteredStories = [...stories];
            } else {
                filteredStories = stories.filter(story => story.category === currentReadingCategory);
            }
            
            // R√©initialiser l'index
            currentStoryIndex = 0;
        }

        // Afficher l'histoire actuelle
        function displayCurrentStory() {
            if (filteredStories.length === 0) {
                document.getElementById('story-display').innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--secondary);">
                        <span style="font-size: 3rem; display: block; margin-bottom: 1rem;">üìö</span>
                        <p>Aucune histoire disponible dans cette cat√©gorie.</p>
                    </div>
                `;
                return;
            }

            const story = filteredStories[currentStoryIndex];
            
            // V√©rifier l'humeur d√©j√† enregistr√©e
            const existingMood = storyMoodHistory.find(m => m.storyId === story.id);
            const userMood = existingMood ? existingMood.mood : null;
            
            // G√©n√©rer les boutons d'humeur
            let moodButtonsHTML = '';
            storyMoodOptions.forEach(mood => {
                const isSelected = userMood === mood.emoji;
                moodButtonsHTML += `
                    <button class="story-mood-btn ${isSelected ? 'selected' : ''}" 
                            data-mood="${mood.emoji}"
                            style="${isSelected ? `background-color: ${mood.color};` : ''}">
                        <span class="story-mood-emoji">${mood.emoji}</span>
                        <span class="story-mood-label">${mood.label}</span>
                    </button>
                `;
            });

            // Afficher l'histoire
            document.getElementById('story-display').innerHTML = `
                <div class="story-image-display">
                    <img src="${story.image}" alt="${story.title}">
                    <div class="story-category-badge">
                        ${story.category === 'routine' ? 'üîÑ Routine' : 'üòÇ Dr√¥le'}
                    </div>
                </div>
                
                <h2 style="font-size: 1.75rem; font-weight: 700; color: var(--foreground); margin-bottom: 1rem;">
                    ${story.title}
                </h2>
                
                <div class="story-text">
                    ${story.content}
                </div>
                
                <div class="story-controls">
                    <button class="story-control-btn primary" id="read-story-btn">
                        <span>üîä</span>
                        √âcouter cette histoire
                    </button>
                </div>
                
                <div class="story-mood-evaluation">
                    <div class="mood-evaluation-title">
                        Cette histoire te fait sentir comment ?
                    </div>
                    <div class="story-moods-grid" id="story-moods-grid">
                        ${moodButtonsHTML}
                    </div>
                </div>
            `;
            
            // Mettre √† jour le compteur
            document.getElementById('story-counter').textContent = 
                `Histoire ${currentStoryIndex + 1} sur ${filteredStories.length}`;
            
            // Mettre √† jour les boutons de navigation
            document.getElementById('prev-story').disabled = currentStoryIndex === 0;
            document.getElementById('next-story').disabled = currentStoryIndex === filteredStories.length - 1;
            
            // Ajouter les √©couteurs d'√©v√©nements
            setupStoryEventListeners(story);
        }

        // Configurer les √©couteurs d'√©v√©nements pour l'histoire
        function setupStoryEventListeners(story) {
            // Bouton de lecture
            const readBtn = document.getElementById('read-story-btn');
            readBtn.addEventListener('click', function() {
                readStoryAloud(story, readBtn);
            });
            
            // Boutons d'humeur
            document.querySelectorAll('#story-moods-grid .story-mood-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const mood = this.dataset.mood;
                    saveStoryMood(story, mood);
                    
                    // Mettre √† jour l'affichage
                    document.querySelectorAll('#story-moods-grid .story-mood-btn').forEach(b => {
                        b.classList.remove('selected');
                        b.style.backgroundColor = '';
                    });
                    
                    this.classList.add('selected');
                    const moodObj = storyMoodOptions.find(m => m.emoji === mood);
                    if (moodObj) {
                        this.style.backgroundColor = moodObj.color;
                    }
                });
            });
        }

        // Lire une histoire √† voix haute
        function readStoryAloud(story, buttonElement) {
            if (isSpeaking && currentUtterance) {
                // Arr√™ter la lecture si en cours
                speechSynthesis.cancel();
                isSpeaking = false;
                buttonElement.innerHTML = '<span>üîä</span> √âcouter cette histoire';
                return;
            }
            
            const text = `${story.title}. ${story.content}`;
            
            // Cr√©er l'√©nonc√©
            currentUtterance = new SpeechSynthesisUtterance(text);
            currentUtterance.lang = 'fr-FR';
            currentUtterance.rate = 0.9;
            currentUtterance.pitch = 1;
            currentUtterance.volume = 1;
            
            currentUtterance.onstart = function() {
                isSpeaking = true;
                buttonElement.innerHTML = '<span>‚èπÔ∏è</span> Arr√™ter la lecture';
                showToast('üîä Lecture en cours...', 'info');
            };
            
            currentUtterance.onend = function() {
                isSpeaking = false;
                buttonElement.innerHTML = '<span>üîä</span> √âcouter cette histoire';
                showToast('‚úÖ Lecture termin√©e', 'success');
                currentUtterance = null;
            };
            
            currentUtterance.onerror = function() {
                isSpeaking = false;
                buttonElement.innerHTML = '<span>üîä</span> √âcouter cette histoire';
                showToast('üîá Erreur de lecture', 'error');
                currentUtterance = null;
            };
            
            // Lancer la lecture
            speechSynthesis.speak(currentUtterance);
        }

        // Enregistrer l'humeur pour une histoire
        function saveStoryMood(story, moodEmoji) {
            // V√©rifier si une humeur existe d√©j√† pour cette histoire
            const existingIndex = storyMoodHistory.findIndex(m => m.storyId === story.id);
            const moodLabel = storyMoodOptions.find(m => m.emoji === moodEmoji)?.label || moodEmoji;
            
            const moodEntry = {
                storyId: story.id,
                storyTitle: story.title,
                mood: moodEmoji,
                moodLabel: moodLabel,
                date: new Date().toISOString(),
                category: story.category
            };
            
            if (existingIndex !== -1) {
                // Mettre √† jour l'humeur existante
                storyMoodHistory[existingIndex] = moodEntry;
            } else {
                // Ajouter une nouvelle humeur
                storyMoodHistory.push(moodEntry);
            }
            
            // Sauvegarder
            saveStoryMoodHistory();
            
            // Afficher le message de succ√®s
            showToast(`üìñ Humeur enregistr√©e pour "${story.title}"`, 'success');
        }

        // Afficher l'histoire pr√©c√©dente
        function showPreviousStory() {
            if (currentStoryIndex > 0) {
                currentStoryIndex--;
                displayCurrentStory();
                
                // Arr√™ter la lecture si en cours
                if (isSpeaking) {
                    speechSynthesis.cancel();
                    isSpeaking = false;
                }
            }
        }

        // Afficher l'histoire suivante
        function showNextStory() {
            if (currentStoryIndex < filteredStories.length - 1) {
                currentStoryIndex++;
                displayCurrentStory();
                
                // Arr√™ter la lecture si en cours
                if (isSpeaking) {
                    speechSynthesis.cancel();
                    isSpeaking = false;
                }
            }
        }

        // Fonctions du journal (inchang√©es)
        function saveMood() {
            if (!selectedMood) {
                showToast('ü§î Choisis comment tu te sens !', 'error');
                return;
            }

            const note = document.getElementById('note-textarea').value.trim();
            const moodEntry = {
                id: Date.now(),
                date: new Date().toISOString(),
                mood: selectedMood,
                moodLabel: moods.find(m => m.emoji === selectedMood)?.label || selectedMood,
                note: note || undefined,
                noteType: currentNoteType
            };

            moodHistory.push(moodEntry);
            saveMoodHistory();
            renderMoodHistory();
            
            selectedMood = null;
            document.getElementById('note-textarea').value = '';
            setupMoodButtons();
            document.getElementById('read-btn').disabled = true;
            currentNoteType = 'text';
            
            showToast('üìù Ton humeur a √©t√© enregistr√©e !', 'success');
        }

        function toggleRecording() {
            const micBtn = document.getElementById('mic-btn');
            const micIcon = document.getElementById('mic-icon');
            const textarea = document.getElementById('note-textarea');

            if (!isRecording) {
                isRecording = true;
                micBtn.classList.add('recording');
                micIcon.textContent = '‚èπÔ∏è';
                showToast('üéôÔ∏è Enregistrement en cours...', 'info');
                
                setTimeout(() => {
                    if (isRecording) {
                        toggleRecording();
                        const voiceMessage = '[Message vocal enregistr√©]';
                        if (textarea.value.trim()) {
                            textarea.value = textarea.value + ' ' + voiceMessage;
                        } else {
                            textarea.value = voiceMessage;
                        }
                        document.getElementById('read-btn').disabled = false;
                        currentNoteType = 'voice';
                        showToast('üé§ Message vocal enregistr√© !', 'success');
                    }
                }, 3000);
            } else {
                isRecording = false;
                micBtn.classList.remove('recording');
                micIcon.textContent = 'üé§';
            }
        }

        function readText() {
            const text = document.getElementById('note-textarea').value.trim();
            if (!text) {
                showToast('üìù Aucun texte √† lire !', 'error');
                return;
            }
            
            if (text.includes('[Message vocal enregistr√©]')) {
                speakText("Message vocal enregistr√©. Pour √©couter la note compl√®te, enregistre ton humeur et consulte l'historique.", 'fr-FR');
                showToast('üé§ Message vocal - Enregistre pour √©couter', 'info');
            } else {
                speakText(text, 'fr-FR');
                showToast('üîä Texte lu √† voix haute', 'info');
            }
        }

        function readModalNote() {
            const noteText = document.getElementById('modal-note-text').textContent;
            const noNoteText = 'Aucune note pour cette entr√©e.';
            
            if (noteText && noteText !== noNoteText) {
                const moodId = parseInt(document.querySelector('.mood-item.selected')?.dataset.id);
                const mood = moodHistory.find(m => m.id === moodId);
                const noteType = mood?.noteType || 'text';
                
                if (noteType === 'voice') {
                    speakText("Note enregistr√©e vocalement. Cette note a √©t√© cr√©√©e par enregistrement vocal.", 'fr-FR');
                } else {
                    speakText(noteText, 'fr-FR');
                }
            }
        }

        function speakText(text, lang) {
            if (isSpeaking) {
                speechSynthesis.cancel();
            }
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang;
            utterance.rate = 0.9;
            utterance.pitch = 1;
            utterance.volume = 1;
            
            utterance.onstart = function() {
                isSpeaking = true;
            };
            
            utterance.onend = function() {
                isSpeaking = false;
            };
            
            utterance.onerror = function() {
                isSpeaking = false;
                showToast('üîá Erreur de synth√®se vocale', 'error');
            };
            
            speechSynthesis.speak(utterance);
        }

        function renderMoodHistory() {
            const container = document.getElementById('history-container');
            
            if (moodHistory.length === 0) {
                container.innerHTML = `
                    <div class="history-empty">
                        <span class="history-emoji">üìù</span>
                        <p>Pas encore d'humeurs enregistr√©es</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = '';
            const recentMoods = moodHistory.slice(-10).reverse();
            
            recentMoods.forEach((mood, index) => {
                const moodElement = document.createElement('div');
                moodElement.className = 'mood-item';
                moodElement.style.animationDelay = `${index * 0.05}s`;
                moodElement.dataset.id = mood.id;

                const date = new Date(mood.date);
                const dateString = date.toLocaleDateString('fr-FR', {
                    weekday: 'long',
                    day: 'numeric',
                    month: 'long',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                const noteType = mood.noteType || 'text';
                const noteTypeClass = noteType === 'voice' ? 'voice' : 'text';
                const noteTypeLabel = noteType === 'voice' ? 'üé§ Vocal' : 'üìù Texte';
                const displayNote = mood.note || '';

                moodElement.innerHTML = `
                    <span class="mood-item-emoji">${mood.mood}</span>
                    <div class="mood-item-content">
                        <div class="mood-item-date">${dateString}</div>
                        ${displayNote ? `
                            <div class="mood-item-note">
                                <span class="note-type-badge ${noteTypeClass}">${noteTypeLabel}</span>
                                ${displayNote.substring(0, 40)}${displayNote.length > 40 ? '...' : ''}
                            </div>
                        ` : ''}
                    </div>
                `;

                moodElement.addEventListener('click', () => {
                    document.querySelectorAll('.mood-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                    moodElement.classList.add('selected');
                    viewNote(mood.id);
                });
                
                container.appendChild(moodElement);
            });
        }

        function viewNote(id) {
            const mood = moodHistory.find(m => m.id === id);
            if (!mood) return;
            
            document.getElementById('modal-emoji').textContent = mood.mood;
            const noteText = mood.note || 'Aucune note pour cette entr√©e.';
            const noteElement = document.getElementById('modal-note-text');
            noteElement.textContent = noteText;
            
            if (!mood.note) {
                noteElement.classList.add('empty');
            } else {
                noteElement.classList.remove('empty');
            }
            
            const noteType = mood.noteType || 'text';
            const noteTypeBadge = document.getElementById('modal-note-type');
            noteTypeBadge.textContent = noteType === 'voice' ? 'üé§ Vocal' : 'üìù Texte';
            noteTypeBadge.className = `note-type-badge ${noteType}`;
            
            document.getElementById('note-modal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('note-modal').classList.remove('show');
            if (isSpeaking) {
                speechSynthesis.cancel();
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastEmoji = document.getElementById('toast-emoji');
            const toastMessage = document.getElementById('toast-message');

            let emoji = 'üìù';
            if (type === 'error') emoji = 'ü§î';
            if (type === 'info') emoji = 'üîä';
            if (type === 'success') emoji = '‚úÖ';

            toastEmoji.textContent = emoji;
            toastMessage.textContent = message;
            
            toast.className = 'toast';
            if (type === 'error') toast.classList.add('toast-error');
            if (type === 'info') toast.classList.add('toast-info');
            
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        // Fonction pour voir une image en grand
function viewImageInModal(imageUrl, title = '') {
    // Mettre √† jour le titre
    document.getElementById('image-modal-title').textContent = title || 'üì∏';
    
    // Cr√©er l'√©l√©ment image
    const imageContainer = document.getElementById('modal-image-container');
    imageContainer.innerHTML = `
        <img src="${imageUrl}" alt="${title || 'Image'}">
        ${title ? `<div class="modal-image-caption">${title}</div>` : ''}
    `;
    
    // Afficher le modal
    document.getElementById('image-modal').classList.add('show');
}

// Fermer le modal des images
function closeImageModal() {
    document.getElementById('image-modal').classList.remove('show');
}

// √âv√©nement pour fermer le modal des images
document.getElementById('close-image-modal').addEventListener('click', closeImageModal);
document.getElementById('close-image-btn').addEventListener('click', closeImageModal);

// Fermer le modal en cliquant √† l'ext√©rieur
document.getElementById('image-modal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeImageModal();
    }
});
    </script>
</body>
</html>
