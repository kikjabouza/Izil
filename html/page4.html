<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espace Calme - Relaxation pour personnes autistes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #4a6fa5;
            --primary-foreground: #ffffff;
            --primary-hover: #3a5a8c;
            --lavender: #9d8df1;
            --mint: #88d9e6;
            --peach: #ffb8a1;
            --sunshine: #ffd166;
            --blue-400: #60a5fa;
            --green-400: #4ade80;
            --sky-300: #7dd3fc;
            --background: #f8f9fa;
            --foreground: #1a1a1a;
            --muted: #6c757d;
            --muted-foreground: #6c757d;
            --card: #ffffff;
            --card-foreground: #1a1a1a;
            --border: #e0e0e0;
            --border-hover: #d0d0d0;
            --indigo-900: #312e81;
            --purple-900: #581c87;
            --shadow-soft: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-medium: 0 8px 24px rgba(0, 0, 0, 0.12);
            --shadow-glow: 0 8px 32px rgba(74, 111, 165, 0.2);
            --border-radius: 1rem;
            --border-radius-lg: 1.5rem;
            --border-radius-xl: 2rem;
            --danger: #ef4444;
            --danger-hover: #dc2626;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: var(--foreground);
            min-height: 100vh;
            padding: 2rem 1rem;
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 2rem;
            animation: fadeIn 0.8s ease-out;
        }

        .header-emoji {
            font-size: 4rem;
            margin-bottom: 1rem;
            display: block;
            animation: float 3s ease-in-out infinite;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--foreground);
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1.1rem;
            color: var(--muted-foreground);
        }

        /* Mode Urgence */
        .emergency-btn {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            background-color: var(--danger);
            color: white;
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
            transition: all 0.3s ease;
        }

        .emergency-btn:hover {
            background-color: var(--danger-hover);
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(239, 68, 68, 0.4);
        }

        /* Mode Urgence - √âcran */
        .emergency-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            z-index: 9999;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
            padding: 2rem;
        }

        .emergency-overlay.active {
            display: flex;
        }

        .emergency-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2rem;
            animation: pulse-emergency 3s ease-in-out infinite;
        }

        .emergency-circle-inner {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .emergency-message {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
        }

        .emergency-submessage {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin-bottom: 2rem;
        }

        /* S√©lecteur de th√®me */
        .theme-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        @media (min-width: 768px) {
            .theme-selector {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .theme-btn {
            padding: 1.5rem;
            border-radius: var(--border-radius-xl);
            border: 2px solid var(--border);
            background-color: var(--card);
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
            color: var(--foreground);
            text-align: center;
        }

        .theme-btn:hover {
            transform: scale(1.05);
            border-color: rgba(74, 111, 165, 0.5);
            box-shadow: var(--shadow-soft);
        }

        .theme-btn.active {
            border-color: transparent;
            box-shadow: var(--shadow-glow);
            color: white;
        }

        .theme-btn.active.blue-400 { background-color: var(--blue-400); }
        .theme-btn.active.green-400 { background-color: var(--green-400); }
        .theme-btn.active.sky-300 { background-color: var(--sky-300); }
        .theme-btn.active.lavender { background-color: var(--lavender); }

        .theme-emoji {
            font-size: 2.5rem;
        }

        /* Carte d'exercice de respiration */
        .card {
            background-color: var(--card);
            border-radius: var(--border-radius-xl);
            padding: 2rem;
            box-shadow: var(--shadow-medium);
            border: 1px solid var(--border);
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: var(--shadow-glow);
            border-color: rgba(74, 111, 165, 0.2);
        }

        .card h2 {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--foreground);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        /* Exercice de respiration */
        .breathing-container {
            position: relative;
            width: 16rem;
            height: 16rem;
            margin: 0 auto 2rem;
        }

        @media (min-width: 768px) {
            .breathing-container {
                width: 20rem;
                height: 20rem;
            }
        }

        .breathing-bg {
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background-color: rgba(74, 111, 165, 0.1);
        }

        .breathing-circle {
            position: absolute;
            inset: 1rem;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--lavender));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
            font-weight: 500;
        }

        .breathing-circle.breathing {
            animation: breathing 4s ease-in-out infinite;
        }

        .breathing-circle.inhale {
            background: linear-gradient(135deg, #4a6fa5, #7dd3fc);
        }

        .breathing-circle.hold {
            background: linear-gradient(135deg, #7dd3fc, #9d8df1);
        }

        .breathing-circle.exhale {
            background: linear-gradient(135deg, #9d8df1, #4a6fa5);
        }

        /* Boutons */
        .button-group {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .btn {
            padding: 0.875rem 1.75rem;
            border-radius: var(--border-radius-lg);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border: 2px solid transparent;
        }

        .btn-primary {
            background-color: var(--primary);
            color: var(--primary-foreground);
            border: none;
        }

        .btn-primary:hover {
            background-color: var(--primary-hover);
            transform: scale(1.05);
            box-shadow: var(--shadow-glow);
        }

        .btn-outline {
            background-color: transparent;
            border-color: var(--border);
            color: var(--foreground);
        }

        .btn-outline:hover {
            border-color: var(--primary);
            background-color: rgba(74, 111, 165, 0.05);
            transform: scale(1.05);
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        /* Contr√¥les audio */
        .audio-controls {
            margin-top: 2rem;
        }

        .sound-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            justify-content: center;
            margin-top: 1rem;
        }

        .sound-btn {
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            background-color: rgba(74, 111, 165, 0.1);
            border: 2px solid rgba(74, 111, 165, 0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .sound-btn:hover {
            background-color: rgba(74, 111, 165, 0.2);
            transform: scale(1.05);
        }

        .sound-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Messages rassurants */
        .reassuring-messages {
            margin: 2rem 0;
            text-align: center;
        }

        .message-box {
            background-color: rgba(74, 111, 165, 0.1);
            border-radius: var(--border-radius-lg);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            font-size: 1.2rem;
            font-weight: 500;
            animation: fadeIn 1s ease-out;
        }

        /* Personnalisation sensorielle */
        .preferences {
            margin-top: 2rem;
        }

        .preference-option {
            margin-bottom: 1.5rem;
        }

        .preference-option label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .slider {
            flex-grow: 1;
            height: 8px;
            border-radius: 4px;
            background-color: var(--border);
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: var(--primary);
            cursor: pointer;
        }

        /* Timer de calme */
        .timer-container {
            text-align: center;
            margin-top: 2rem;
        }

        .timer-circle {
            position: relative;
            width: 12rem;
            height: 12rem;
            margin: 0 auto 1.5rem;
        }

        .timer-svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .timer-circle-bg {
            fill: none;
            stroke: rgba(74, 111, 165, 0.1);
            stroke-width: 8;
        }

        .timer-circle-fill {
            fill: none;
            stroke: var(--primary);
            stroke-width: 8;
            stroke-linecap: round;
            stroke-dasharray: 628;
            stroke-dashoffset: 628;
            transition: stroke-dashoffset 1s linear;
        }

        .timer-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            font-weight: 700;
        }

        /* Routine */
        .routine {
            margin-top: 2rem;
        }

        .routine-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background-color: rgba(74, 111, 165, 0.05);
            border-radius: var(--border-radius);
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .routine-item:hover {
            background-color: rgba(74, 111, 165, 0.1);
        }

        .routine-checkbox {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            flex-shrink: 0;
        }

        .routine-checkbox.checked {
            background-color: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* Mini-jeu sensoriel */
        .sensory-game {
            margin-top: 2rem;
            min-height: 200px;
            border-radius: var(--border-radius-lg);
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            position: relative;
            overflow: hidden;
        }

        .game-instruction {
            text-align: center;
            padding: 1.5rem;
            font-weight: 500;
        }

        .bubble {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(74, 111, 165, 0.2);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }

        .bubble:hover {
            transform: scale(1.2);
            background-color: rgba(74, 111, 165, 0.4);
        }

        /* Animations apaisantes */
        .animations-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        @media (min-width: 768px) {
            .animations-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .animation-box {
            aspect-ratio: 16/9;
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            position: relative;
        }

        .ocean-waves {
            background: linear-gradient(to bottom, #e0f2fe, #60a5fa);
        }

        .floating-clouds {
            background: linear-gradient(to bottom, #f0f9ff, #bae6fd);
        }

        .fireflies {
            background: linear-gradient(to bottom, var(--indigo-900), var(--purple-900));
        }

        .wave {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            border-radius: 50% 50% 0 0;
        }

        .wave-1 {
            height: 33%;
            background-color: rgba(37, 99, 235, 0.5);
        }

        .wave-2 {
            height: 25%;
            background-color: rgba(29, 78, 216, 0.5);
        }

        .center-emoji {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
        }

        .floating-emoji {
            position: absolute;
            font-size: 2.5rem;
        }

        .moon {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 2.5rem;
        }

        .firefly {
            position: absolute;
            font-size: 1.5rem;
        }

        /* Animations CSS */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes breathing {
            0%, 100% {
                transform: scale(1);
            }
            33% {
                transform: scale(1.3);
            }
            66% {
                transform: scale(1.3);
            }
        }

        @keyframes waveMove1 {
            0%, 100% {
                transform: translateX(0);
            }
            50% {
                transform: translateX(20px);
            }
        }

        @keyframes waveMove2 {
            0%, 100% {
                transform: translateX(0);
            }
            50% {
                transform: translateX(-15px);
            }
        }

        @keyframes cloudMove1 {
            0% {
                transform: translateX(-50px);
            }
            100% {
                transform: translateX(200px);
            }
        }

        @keyframes cloudMove2 {
            0% {
                transform: translateX(200px);
            }
            100% {
                transform: translateX(-50px);
            }
        }

        @keyframes firefly {
            0%, 100% {
                opacity: 0.3;
                transform: scale(0.8);
            }
            50% {
                opacity: 1;
                transform: scale(1.2);
            }
        }

        @keyframes pulse-emergency {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.05);
                opacity: 0.9;
            }
        }

        @keyframes bubble-float {
            0% {
                transform: translateY(0);
            }
            100% {
                transform: translateY(-100vh);
            }
        }

        .wave-1 {
            animation: waveMove1 3s ease-in-out infinite;
        }

        .wave-2 {
            animation: waveMove2 2.5s ease-in-out infinite 0.5s;
        }

        .cloud1 {
            animation: cloudMove1 8s linear infinite;
        }

        .cloud2 {
            animation: cloudMove2 10s linear infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- En-t√™te -->
        <div class="header">
            <span class="header-emoji">üß†</span>
            <h1>Espace Calme Autiste</h1>
            <p>Un environnement apaisant et personnalis√© pour se recentrer</p>
        </div>

        <!-- Messages rassurants -->
        <div class="reassuring-messages">
            <div class="message-box" id="reassuring-message">
                Tu es en s√©curit√© ici. Prends ton temps.
            </div>
        </div>

        <!-- S√©lecteur de th√®me -->
        <div class="theme-selector" id="theme-selector">
            <!-- Les boutons de th√®me seront g√©n√©r√©s par JavaScript -->
        </div>

        <!-- Personnalisation sensorielle -->
        <div class="card">
            <h2>Pr√©f√©rences sensorielles</h2>
            <div class="preferences">
                <div class="preference-option">
                    <label for="color-intensity">Intensit√© des couleurs</label>
                    <div class="slider-container">
                        <input type="range" id="color-intensity" class="slider" min="1" max="10" value="5">
                        <span id="color-value">5/10</span>
                    </div>
                </div>
                <div class="preference-option">
                    <label for="animation-speed">Vitesse des animations</label>
                    <div class="slider-container">
                        <input type="range" id="animation-speed" class="slider" min="1" max="10" value="5">
                        <span id="speed-value">5/10</span>
                    </div>
                </div>
                <div class="preference-option">
                    <label for="brightness">Luminosit√©</label>
                    <div class="slider-container">
                        <input type="range" id="brightness" class="slider" min="1" max="10" value="5">
                        <span id="brightness-value">5/10</span>
                    </div>
                </div>
                <button class="btn btn-outline btn-small" id="low-stimulation-btn">
                    üîÖ Mode faible stimulation
                </button>
            </div>
        </div>

        <!-- Exercice de respiration -->
        <div class="card">
            <h2>Exercice de Respiration Guid√©e</h2>
            
            <div class="breathing-container">
                <div class="breathing-bg"></div>
                <div class="breathing-circle" id="breathing-circle">
                    Pr√™t ?
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" id="start-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="5 3 19 12 5 21 5 3"></polygon>
                    </svg>
                    Commencer
                </button>
                <button class="btn btn-outline" id="pause-btn" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="6" y="4" width="4" height="16"></rect>
                        <rect x="14" y="4" width="4" height="16"></rect>
                    </svg>
                    Pause
                </button>
                <button class="btn btn-outline" id="voice-guidance-btn">
                    üó£Ô∏è Guidance vocale
                </button>
            </div>
        </div>

        <!-- Timer de calme -->
        <div class="card">
            <h2>Timer de Calme</h2>
            <div class="timer-container">
                <div class="timer-circle">
                    <svg class="timer-svg">
                        <circle class="timer-circle-bg" cx="50%" cy="50%" r="45%"></circle>
                        <circle class="timer-circle-fill" cx="50%" cy="50%" r="45%"></circle>
                    </svg>
                    <div class="timer-display" id="timer-display">00:00</div>
                </div>
                <div class="button-group">
                    <button class="btn btn-outline timer-btn" data-time="60">1 min</button>
                    <button class="btn btn-outline timer-btn" data-time="180">3 min</button>
                    <button class="btn btn-outline timer-btn" data-time="300">5 min</button>
                    <button class="btn btn-outline" id="stop-timer">Arr√™ter</button>
                </div>
            </div>
        </div>

        <!-- Contr√¥les audio -->
        <div class="card">
            <h2>Sons Apaisants</h2>
            <div class="audio-controls">
                <div class="button-group">
                    <button class="btn btn-outline" id="audio-toggle">
                        üîä Activer les sons
                    </button>
                </div>
                
                <div class="sound-buttons" id="sound-buttons">
                    <!-- Les boutons de sons seront g√©n√©r√©s par JavaScript -->
                </div>
            </div>
        </div>

        <!-- Routine -->
        <div class="card">
            <h2>Ma Routine Calme</h2>
            <div class="routine">
                <div class="routine-item" data-action="breathing">
                    <div class="routine-checkbox"></div>
                    <div class="routine-text">Exercice de respiration (4 cycles)</div>
                </div>
                <div class="routine-item" data-action="timer">
                    <div class="routine-checkbox"></div>
                    <div class="routine-text">Timer de calme (3 minutes)</div>
                </div>
                <div class="routine-item" data-action="sounds">
                    <div class="routine-checkbox"></div>
                    <div class="routine-text">Sons apaisants (pluie)</div>
                </div>
                <div class="routine-item" data-action="message">
                    <div class="routine-checkbox"></div>
                    <div class="routine-text">Message rassurant</div>
                </div>
            </div>
            <div class="button-group" style="margin-top: 1.5rem;">
                <button class="btn btn-primary" id="start-routine">
                    ‚ñ∂ D√©marrer la routine
                </button>
            </div>
        </div>

        <!-- Mini-jeu sensoriel -->
        <div class="card">
            <h2>Mini-Jeu Sensoriel</h2>
            <div class="sensory-game" id="sensory-game">
                <div class="game-instruction">Clique sur les bulles qui apparaissent pour les faire dispara√Ætre</div>
                <!-- Les bulles seront g√©n√©r√©es par JavaScript -->
            </div>
        </div>

        <!-- Animations apaisantes -->
        <div class="card">
            <h2>Animations Apaisantes</h2>
            
            <div class="animations-grid">
                <!-- Vagues oc√©an -->
                <div class="animation-box ocean-waves">
                    <div class="wave wave-1"></div>
                    <div class="wave wave-2"></div>
                    <span class="center-emoji">üåä</span>
                </div>

                <!-- Nuages flottants -->
                <div class="animation-box floating-clouds">
                    <span class="floating-emoji cloud1" style="top: 1rem;">‚òÅÔ∏è</span>
                    <span class="floating-emoji cloud2" style="top: 3rem;">‚òÅÔ∏è</span>
                    <span class="center-emoji" style="bottom: 1rem; top: auto; transform: translateX(-50%);">üå§Ô∏è</span>
                </div>

                <!-- Lucioles -->
                <div class="animation-box fireflies" id="fireflies-container">
                    <span class="moon">üåô</span>
                    <!-- Les lucioles seront g√©n√©r√©es par JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Mode Urgence -->
    <button class="emergency-btn" id="emergency-btn">‚ö†Ô∏è</button>
    
    <div class="emergency-overlay" id="emergency-overlay">
        <div class="emergency-circle">
            <div class="emergency-circle-inner">
                Respire avec moi
            </div>
        </div>
        <div class="emergency-message">Respire avec moi</div>
        <div class="emergency-submessage">
            Tu es en s√©curit√©. Inspire lentement par le nez, retiens ta respiration un instant, puis expire doucement par la bouche.
        </div>
        <button class="btn btn-primary" id="exit-emergency">Je me sens mieux</button>
    </div>

    <script>
        // Donn√©es des th√®mes
        const themes = [
            { id: 'ocean', label: 'Oc√©an', color: 'blue-400', emoji: 'üåä' },
            { id: 'forest', label: 'For√™t', color: 'green-400', emoji: 'üå≤' },
            { id: 'sky', label: 'Nuages', color: 'sky-300', emoji: '‚òÅÔ∏è' },
            { id: 'breath', label: 'Respiration', color: 'lavender', emoji: 'üí®' },
        ];

        // Donn√©es des sons
        const sounds = [
            { id: 'rain', label: 'Pluie douce', emoji: 'üåßÔ∏è' },
            { id: 'ocean', label: 'Vagues de mer', emoji: 'üåä' },
            { id: 'wind', label: 'Vent l√©ger', emoji: 'üå¨Ô∏è' },
            { id: 'bell', label: 'Cloche tib√©taine', emoji: 'üîî' },
            { id: 'piano', label: 'Piano doux', emoji: 'üéπ' },
            { id: 'birds', label: 'Chants d\'oiseaux', emoji: 'üê¶' }
        ];

        // Messages rassurants
        const reassuringMessages = [
            "Tu es en s√©curit√©.",
            "Tu fais du bon travail.",
            "Respire doucement, je suis l√† avec toi.",
            "Tu peux prendre ton temps.",
            "Chaque respiration t'aide √† te recentrer.",
            "Tu es fort et capable.",
            "Cet instant difficile va passer.",
            "√âcoute ton corps, il sait ce dont tu as besoin.",
            "Tu n'es pas seul.",
            "Tes sentiments sont valides et importants."
        ];

        // √âtat de l'application
        let currentTheme = 'ocean';
        let isBreathing = false;
        let breathPhase = 'inhale';
        let breathingInterval = null;
        let isAudioActive = false;
        let currentSound = null;
        let currentAudio = null;
        let isVoiceGuidance = false;
        let isEmergencyMode = false;
        let timerInterval = null;
        let timerSeconds = 0;
        let timerTotalSeconds = 0;
        let routineItems = [];
        let isLowStimulation = false;

        // Sons (liens vers des fichiers audio libres de droits)
        const soundFiles = {
            'rain': 'https://assets.mixkit.co/sfx/preview/mixkit-rain-loop-1249.mp3',
            'ocean': 'https://assets.mixkit.co/sfx/preview/mixkit-ocean-waves-loop-1243.mp3',
            'wind': 'https://assets.mixkit.co/sfx/preview/mixkit-wind-in-the-trees-1251.mp3',
            'bell': 'https://assets.mixkit.co/sfx/preview/mixkit-bell-meditation-597.mp3',
            'piano': 'https://assets.mixkit.co/sfx/preview/mixkit-piano-ambient-1125.mp3',
            'birds': 'https://assets.mixkit.co/sfx/preview/mixkit-birds-chirping-1240.mp3'
        };

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            initThemeSelector();
            initFireflies();
            initSoundButtons();
            setupEventListeners();
            updateReassuringMessage();
            initSensoryGame();
            initRoutine();
        });

        // Initialiser le s√©lecteur de th√®me
        function initThemeSelector() {
            const container = document.getElementById('theme-selector');
            
            themes.forEach(theme => {
                const button = document.createElement('button');
                button.className = `theme-btn ${currentTheme === theme.id ? 'active ' + theme.color : ''}`;
                button.innerHTML = `
                    <span class="theme-emoji">${theme.emoji}</span>
                    <span>${theme.label}</span>
                `;
                
                button.addEventListener('click', () => {
                    // Retirer la classe active de tous les boutons
                    document.querySelectorAll('.theme-btn').forEach(btn => {
                        btn.classList.remove('active', 'blue-400', 'green-400', 'sky-300', 'lavender');
                    });
                    
                    // Ajouter la classe active au bouton cliqu√©
                    button.classList.add('active', theme.color);
                    currentTheme = theme.id;
                    
                    // Changer le message rassurant
                    updateReassuringMessage();
                });
                
                container.appendChild(button);
            });
        }

        // Initialiser les lucioles
        function initFireflies() {
            const container = document.getElementById('fireflies-container');
            
            // Cr√©er 6 lucioles
            for (let i = 0; i < 6; i++) {
                const firefly = document.createElement('span');
                firefly.className = 'firefly';
                firefly.textContent = '‚ú®';
                
                // Position al√©atoire
                const left = Math.random() * 80 + 10;
                const top = Math.random() * 60 + 20;
                
                firefly.style.left = `${left}%`;
                firefly.style.top = `${top}%`;
                
                // Animation al√©atoire
                const duration = 2 + Math.random() * 2;
                const delay = Math.random() * 2;
                
                firefly.style.animation = `firefly ${duration}s ease-in-out ${delay}s infinite`;
                
                container.appendChild(firefly);
            }

            // Ajouter l'animation CSS pour les lucioles
            const style = document.createElement('style');
            style.textContent = `
                @keyframes firefly {
                    0%, 100% {
                        opacity: 0.3;
                        transform: scale(0.8) translate(0, 0);
                    }
                    50% {
                        opacity: 1;
                        transform: scale(1.2) translate(${Math.random() * 20 - 10}px, ${Math.random() * 20 - 10}px);
                    }
                }
            `;
            document.head.appendChild(style);
        }

        // Initialiser les boutons de sons
        function initSoundButtons() {
            const container = document.getElementById('sound-buttons');
            
            sounds.forEach(sound => {
                const button = document.createElement('button');
                button.className = 'sound-btn';
                button.id = `sound-${sound.id}`;
                button.innerHTML = `
                    <span>${sound.emoji}</span>
                    <span>${sound.label}</span>
                `;
                
                button.addEventListener('click', () => {
                    if (currentSound === sound.id) {
                        stopSound();
                    } else {
                        playSound(sound.id);
                    }
                });
                
                container.appendChild(button);
            });
        }

        // Initialiser le mini-jeu sensoriel
        function initSensoryGame() {
            const gameContainer = document.getElementById('sensory-game');
            
            // Cr√©er des bulles toutes les 2 secondes
            setInterval(() => {
                if (isEmergencyMode) return;
                
                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                bubble.textContent = 'ü´ß';
                
                // Position al√©atoire
                const left = Math.random() * 80 + 10;
                bubble.style.left = `${left}%`;
                bubble.style.top = `100%`;
                
                // Taille al√©atoire
                const size = Math.random() * 20 + 30;
                bubble.style.width = `${size}px`;
                bubble.style.height = `${size}px`;
                
                // Animation de flottement
                const duration = Math.random() * 5 + 10;
                bubble.style.animation = `bubble-float ${duration}s linear forwards`;
                
                // √âv√©nement de clic
                bubble.addEventListener('click', () => {
                    bubble.style.transform = 'scale(1.5)';
                    bubble.style.opacity = '0';
                    setTimeout(() => {
                        if (bubble.parentNode) {
                            bubble.parentNode.removeChild(bubble);
                        }
                    }, 300);
                });
                
                gameContainer.appendChild(bubble);
                
                // Supprimer la bulle apr√®s l'animation
                setTimeout(() => {
                    if (bubble.parentNode) {
                        bubble.parentNode.removeChild(bubble);
                    }
                }, duration * 1000);
                
            }, 2000);
        }

        // Initialiser la routine
        function initRoutine() {
            routineItems = document.querySelectorAll('.routine-item');
            
            routineItems.forEach(item => {
                const checkbox = item.querySelector('.routine-checkbox');
                const action = item.getAttribute('data-action');
                
                checkbox.addEventListener('click', () => {
                    checkbox.classList.toggle('checked');
                    checkbox.textContent = checkbox.classList.contains('checked') ? '‚úì' : '';
                });
            });
        }

        // Configurer les √©couteurs d'√©v√©nements
        function setupEventListeners() {
            // Bouton de d√©marrage respiration
            document.getElementById('start-btn').addEventListener('click', startBreathingExercise);
            
            // Bouton de pause respiration
            document.getElementById('pause-btn').addEventListener('click', stopBreathingExercise);
            
            // Bouton guidance vocale
            document.getElementById('voice-guidance-btn').addEventListener('click', toggleVoiceGuidance);
            
            // Bouton d'activation audio
            document.getElementById('audio-toggle').addEventListener('click', toggleAudio);
            
            // Boutons timer
            document.querySelectorAll('.timer-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const time = parseInt(btn.getAttribute('data-time'));
                    startTimer(time);
                });
            });
            
            // Bouton arr√™t timer
            document.getElementById('stop-timer').addEventListener('click', stopTimer);
            
            // Mode urgence
            document.getElementById('emergency-btn').addEventListener('click', activateEmergencyMode);
            document.getElementById('exit-emergency').addEventListener('click', deactivateEmergencyMode);
            
            // Routine
            document.getElementById('start-routine').addEventListener('click', startRoutine);
            
            // Personnalisation sensorielle
            document.getElementById('color-intensity').addEventListener('input', updateColorIntensity);
            document.getElementById('animation-speed').addEventListener('input', updateAnimationSpeed);
            document.getElementById('brightness').addEventListener('input', updateBrightness);
            document.getElementById('low-stimulation-btn').addEventListener('click', toggleLowStimulation);
            
            // Mettre √† jour les valeurs des sliders
            updateSliderValues();
        }

        // Jouer un son
        function playSound(soundId) {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }
            
            // Retirer la classe active de tous les boutons de son
            document.querySelectorAll('.sound-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Ajouter la classe active au bouton cliqu√©
            document.getElementById(`sound-${soundId}`).classList.add('active');
            
            // Cr√©er et jouer l'audio
            currentAudio = new Audio(soundFiles[soundId]);
            currentAudio.loop = true;
            currentAudio.volume = 0.5;
            currentAudio.play();
            currentSound = soundId;
        }

        // Arr√™ter le son
        function stopSound() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }
            
            // Retirer la classe active de tous les boutons de son
            document.querySelectorAll('.sound-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            currentSound = null;
        }

        // Activer/d√©sactiver l'audio
        function toggleAudio() {
            isAudioActive = !isAudioActive;
            const button = document.getElementById('audio-toggle');
            
            if (isAudioActive) {
                button.innerHTML = 'üîá D√©sactiver les sons';
                // Jouer un son par d√©faut
                playSound('rain');
            } else {
                button.innerHTML = 'üîä Activer les sons';
                stopSound();
            }
        }

        // Activer/d√©sactiver la guidance vocale
        function toggleVoiceGuidance() {
            isVoiceGuidance = !isVoiceGuidance;
            const button = document.getElementById('voice-guidance-btn');
            
            if (isVoiceGuidance) {
                button.innerHTML = 'üîá D√©sactiver guidance';
                speakMessage("Je vais te guider dans ta respiration. Inspire... Retiens... Expire...");
            } else {
                button.innerHTML = 'üó£Ô∏è Guidance vocale';
            }
        }

        // Parler un message (utilisation de Web Speech API)
        function speakMessage(message) {
            if (!isVoiceGuidance) return;
            
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(message);
                utterance.lang = 'fr-FR';
                utterance.rate = 0.8;
                utterance.pitch = 1;
                utterance.volume = 0.8;
                speechSynthesis.speak(utterance);
            }
        }

        // Mettre √† jour le message rassurant
        function updateReassuringMessage() {
            const messageElement = document.getElementById('reassuring-message');
            const randomIndex = Math.floor(Math.random() * reassuringMessages.length);
            messageElement.textContent = reassuringMessages[randomIndex];
        }

        // D√©marrer l'exercice de respiration
        function startBreathingExercise() {
            isBreathing = true;
            
            // Changer l'affichage des boutons
            document.getElementById('start-btn').style.display = 'none';
            document.getElementById('pause-btn').style.display = 'flex';
            
            // D√©marrer le cycle
            runBreathingCycle();
        }

        // Arr√™ter l'exercice de respiration
        function stopBreathingExercise() {
            isBreathing = false;
            
            // Changer l'affichage des boutons
            document.getElementById('start-btn').style.display = 'flex';
            document.getElementById('pause-btn').style.display = 'none';
            
            // Arr√™ter l'animation
            const circle = document.getElementById('breathing-circle');
            circle.classList.remove('breathing', 'inhale', 'hold', 'exhale');
            circle.textContent = 'Pr√™t ?';
            
            // Arr√™ter l'intervalle
            if (breathingInterval) {
                clearInterval(breathingInterval);
                breathingInterval = null;
            }
        }

        // Ex√©cuter le cycle de respiration
        function runBreathingCycle() {
            if (!isBreathing) return;
            
            const circle = document.getElementById('breathing-circle');
            circle.classList.add('breathing');
            
            // Phase d'inspiration (4 secondes)
            breathPhase = 'inhale';
            circle.classList.remove('hold', 'exhale');
            circle.classList.add('inhale');
            circle.textContent = 'Inspire... üå¨Ô∏è';
            
            if (isVoiceGuidance) speakMessage("Inspire lentement");
            
            setTimeout(() => {
                if (!isBreathing) return;
                
                // Phase de r√©tention (4 secondes)
                breathPhase = 'hold';
                circle.classList.remove('inhale', 'exhale');
                circle.classList.add('hold');
                circle.textContent = 'Retiens... ‚è∏Ô∏è';
                
                if (isVoiceGuidance) speakMessage("Retiens ta respiration");
                
                setTimeout(() => {
                    if (!isBreathing) return;
                    
                    // Phase d'expiration (4 secondes)
                    breathPhase = 'exhale';
                    circle.classList.remove('inhale', 'hold');
                    circle.classList.add('exhale');
                    circle.textContent = 'Expire... üí®';
                    
                    if (isVoiceGuidance) speakMessage("Expire doucement");
                    
                    setTimeout(() => {
                        if (isBreathing) {
                            runBreathingCycle(); // Recommencer le cycle
                        }
                    }, 4000);
                }, 4000);
            }, 4000);
        }

        // D√©marrer le timer
        function startTimer(seconds) {
            stopTimer(); // Arr√™ter tout timer existant
            
            timerTotalSeconds = seconds;
            timerSeconds = seconds;
            
            // Mettre √† jour l'affichage
            updateTimerDisplay();
            
            // Mettre √† jour la barre de progression
            updateTimerProgress();
            
            // D√©marrer l'intervalle
            timerInterval = setInterval(() => {
                timerSeconds--;
                
                if (timerSeconds <= 0) {
                    stopTimer();
                    alert("Le timer est termin√© ! üéâ");
                    updateReassuringMessage();
                    return;
                }
                
                updateTimerDisplay();
                updateTimerProgress();
            }, 1000);
        }

        // Arr√™ter le timer
        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            timerSeconds = 0;
            timerTotalSeconds = 0;
            updateTimerDisplay();
            updateTimerProgress();
        }

        // Mettre √† jour l'affichage du timer
        function updateTimerDisplay() {
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            const display = document.getElementById('timer-display');
            display.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Mettre √† jour la barre de progression du timer
        function updateTimerProgress() {
            const fill = document.querySelector('.timer-circle-fill');
            if (timerTotalSeconds === 0) {
                fill.style.strokeDashoffset = 628;
            } else {
                const progress = 628 - (timerSeconds / timerTotalSeconds) * 628;
                fill.style.strokeDashoffset = progress;
            }
        }

        // Activer le mode urgence
        function activateEmergencyMode() {
            isEmergencyMode = true;
            document.getElementById('emergency-overlay').classList.add('active');
            
            // Arr√™ter tous les sons et animations en cours
            stopSound();
            stopBreathingExercise();
            stopTimer();
            
            // Jouer un son apaisant
            const emergencyAudio = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-meditation-bell-597.mp3');
            emergencyAudio.volume = 0.3;
            emergencyAudio.play();
            
            // Parler un message rassurant
            setTimeout(() => {
                speakMessage("Tu es en s√©curit√©. Respire avec moi. Inspire lentement, retiens, expire doucement.");
            }, 1000);
        }

        // D√©sactiver le mode urgence
        function deactivateEmergencyMode() {
            isEmergencyMode = false;
            document.getElementById('emergency-overlay').classList.remove('active');
            updateReassuringMessage();
        }

        // D√©marrer la routine
        function startRoutine() {
            const checkedItems = [];
            
            routineItems.forEach(item => {
                const checkbox = item.querySelector('.routine-checkbox');
                if (checkbox.classList.contains('checked')) {
                    const action = item.getAttribute('data-action');
                    checkedItems.push(action);
                }
            });
            
            if (checkedItems.length === 0) {
                alert("S√©lectionne au moins une activit√© dans ta routine !");
                return;
            }
            
            // Ex√©cuter les activit√©s dans l'ordre
            executeRoutineStep(checkedItems, 0);
        }

        // Ex√©cuter une √©tape de la routine
        function executeRoutineStep(items, index) {
            if (index >= items.length) {
                alert("Routine termin√©e ! üéâ");
                updateReassuringMessage();
                return;
            }
            
            const action = items[index];
            
            switch (action) {
                case 'breathing':
                    alert("D√©but de l'exercice de respiration");
                    startBreathingExercise();
                    setTimeout(() => {
                        stopBreathingExercise();
                        setTimeout(() => executeRoutineStep(items, index + 1), 1000);
                    }, 16000); // 4 cycles de respiration
                    break;
                    
                case 'timer':
                    alert("D√©marrage du timer de 3 minutes");
                    startTimer(180);
                    setTimeout(() => {
                        stopTimer();
                        setTimeout(() => executeRoutineStep(items, index + 1), 1000);
                    }, 181000); // 3 minutes + 1 seconde
                    break;
                    
                case 'sounds':
                    alert("Activation des sons apaisants");
                    playSound('rain');
                    setTimeout(() => {
                        stopSound();
                        setTimeout(() => executeRoutineStep(items, index + 1), 1000);
                    }, 30000); // 30 secondes de sons
                    break;
                    
                case 'message':
                    updateReassuringMessage();
                    setTimeout(() => executeRoutineStep(items, index + 1), 3000);
                    break;
            }
        }

        // Mettre √† jour l'intensit√© des couleurs
        function updateColorIntensity() {
            const value = document.getElementById('color-intensity').value;
            document.getElementById('color-value').textContent = `${value}/10`;
            
            // Ajuster la saturation globale
            document.body.style.filter = `saturate(${value * 10}%)`;
        }

        // Mettre √† jour la vitesse des animations
        function updateAnimationSpeed() {
            const value = document.getElementById('animation-speed').value;
            document.getElementById('speed-value').textContent = `${value}/10`;
            
            // Ajuster la vitesse d'animation globale
            const speedFactor = value / 5; // 0.2 √† 2
            document.body.style.setProperty('--animation-speed-factor', speedFactor);
            
            // Appliquer aux √©l√©ments anim√©s
            document.querySelectorAll('.breathing-circle, .wave, .cloud1, .cloud2, .firefly').forEach(el => {
                const currentAnimation = getComputedStyle(el).animation;
                if (currentAnimation && currentAnimation !== 'none 0s ease 0s 1 normal none running') {
                    const newAnimation = currentAnimation.replace(/(\d+(\.\d+)?)s/g, (match, p1) => {
                        return (p1 / speedFactor) + 's';
                    });
                    el.style.animation = newAnimation;
                }
            });
        }

        // Mettre √† jour la luminosit√©
        function updateBrightness() {
            const value = document.getElementById('brightness').value;
            document.getElementById('brightness-value').textContent = `${value}/10`;
            
            // Ajuster la luminosit√© globale
            document.body.style.filter = `brightness(${value * 10}%)`;
        }

        // Activer/d√©sactiver le mode faible stimulation
        function toggleLowStimulation() {
            isLowStimulation = !isLowStimulation;
            const button = document.getElementById('low-stimulation-btn');
            
            if (isLowStimulation) {
                button.innerHTML = 'üîÜ Mode normal';
                document.body.style.filter = 'grayscale(50%) brightness(80%)';
                document.body.style.backgroundColor = '#f0f0f0';
            } else {
                button.innerHTML = 'üîÖ Mode faible stimulation';
                document.body.style.filter = '';
                document.body.style.backgroundColor = '';
            }
        }

        // Mettre √† jour les valeurs des sliders
        function updateSliderValues() {
            document.getElementById('color-intensity').dispatchEvent(new Event('input'));
            document.getElementById('animation-speed').dispatchEvent(new Event('input'));
            document.getElementById('brightness').dispatchEvent(new Event('input'));
        }
    </script>
</body>
</html>
